# 게시글 상세 조회

## 구성파일
#### `pages/posts/DetailPage.jsx`
- `/posts/detail/:no` URL에 매핑되는 페이지다.
- 주요 내용
  - 게시글 상세정보를 표현하는 `PostDetail` 컴포넌트를 포함한다.
  - 댓글정보(댓글목록, 댓글입력폼)를 표현하는 `Comment` 컴포넌트를 포함한다.
  - URL 경로에서 게시글번호를 조회한다.
  - 게시글 상세정보, 댓글목록정보를 State로 관리한다.
  - 게시글 상세정보를 조회하는 함수가 있다.
  - 해당 게시글의 댓글목록을 조회하는 함수가 있다.
  - 게시글 삭제 버튼을 클릭했을 때 실행되는 이벤트 핸들러함수가 있다.
  - 댓글추가 버튼을 클릭했을 때 실행되는 이벤트 핸들러함수가 있다.
  - 댓글삭제 버튼을 클릭했을 때 실행되는 이벤트 핸들러함수가 있다.
  - `useEffect`로 게시글번호가 변경될 때 마다 게시글 상세정보와 댓글 목록정보를 백엔드 API에서 데이터를 가져오는 `사이드 이펙트함수`를 실행한다.
  - `PostDetail` 컴포넌트에 게시글상세정보와 게시글삭제 이벤트핸들러함수를 `Props`로 전달한다.
  - `CommentLayout` 컴포넌트에 댓글목록과 댓글추가 이벤트핸들러함수, 댓글삭제 이벤트핸들러함수를 `Props`로 전달한다. 
#### `components/posts/PostDetail.jsx`
- 게시글 상세정보를 표현하는 컴포넌트다.
- 주요 내용
  - `Props`로 게시글 상세정보와 게시글삭제함수를 전달받는다.
  - 게시글 상세정보로 게시글 상세 화면을 렌더링한다.
  - "수정/삭제/목록으로" 버튼 혹은 링크를 제공한다.
#### `layouts/CommentLayout.jsx`
- 댓글 목록정보와 댓글 입력폼을 포함하는 레이아웃 컴포넌트다.
- 주요 내용
  - 댓글 목록을 표시하는 `CommentList` 컴포넌트를 포함한다.
  - 댓글 등록폼을 표시하는 `CommentForm` 컴포넌트를 포함한다.
  - `CommentList` 컴포넌트에 댓글목록과 댓글삭제 이벤트핸들러 함수를 `Props`로 전달한다.
  - `CommentForm` 컴포넌트에 댓글추가 이벤트핸들러 함수를 `Props`로 전달한다.
#### `components/comments/CommentList`
- 댓글 목록을 표시하는 컴포넌트다.
- 주요 내용
  - `Props`로 전달받은 댓글 목록정보로 댓글목록화면을 렌더링한다.
  - 댓글 삭제버튼을 클릭하면 `Props`로 전달받은 댓글삭제 이벤트핸들러 함수를 호출한다.
#### `components/comments/CommentForm`
- 댓들 등록폼을 표시하는 컴포넌트다.
- 주요 내용
  - `State`로 댓글 입력폼의 내용을 관리한다.
  - 댓글 추가버튼을 클릭했을 실행되는 이벤트핸들러 함수가 있다.
#### `api/posts.js`
- `axios`를 사용하여 백엔드 API와 통신한다.
- 주요 내용
  - 게시글 상세정보 요청 함수 제공
  - 게시글 삭제 요청 함수 제공
  - 댓글 목록 요청 함수 제공
  - 댓글 삭제 요청 함수 제공
  - 댓글 추가 요청 함수 제공

## 코드 구현하기
###  백엔드 API와 연동 - `api/posts.js`
1. 게시글 상세정보 조회하기
   - 요청방식: `GET`
   - 요청URI: `/api/posts/게시글번호`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터: 없음
   - 응답데이터:
     ```json
     {
       "statusCode":200,
       "message":"요청이 성공적으로 처리되었습니다.",
       "data": {
         "postNo": 1,
         "name": "홍길동",
         "title": "게시글 연습",
         "content": "게시글 연습 내용입니다.",
         "viewCnt": 0,
         "commentCnt": 0,
         "createdDate": "2025-08-06T12:07:54.211283",
         "updatedDate": "2025-08-06T12:07:54.211283"
       }
     }
     ```
   - 구현코드
     ```javascript
     // 게시글 상세정보를 조회하는 함수
     export const fetchPostDetail = async (postNo) => {
       const response = await axios.get(`${API_BASE}/${postNo}`);
       return response.data;
     }
     ```

2. 게시글 정보 삭제하기
   - 요청방식: `DELETE`
   - 요청URI: `/api/posts/게시글번호`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터: 없음
   - 응답데이터:
     ```json
     {
       "statuscode": 200,
       "message": "게시글이 삭제처리 되었습니다.",
       "data": null
     }
     ```
   - 구현코드
     ```javascript
     // 게시글 정보를 삭제하는 함수
     export const deletePost = async (postNo) => {
       const response = await axios.delete(`${API_BASE}/${postNo}`);
       return response.data;
     }
     ```

3. 댓글목록 조회하기
   - 요청방식: `GET`
   - 요청URI: `/api/posts/게시글번호/comments`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터: 없음
   - 응답데이터:
     ```json
     {
       "statusCode": 200,
       "message": "요청이 성공적으로 처리되었습니다.",
       "data": [
         {
           "commentNo": 1,
           "content": "첫번째 댓글 내용입니다.",
           "createdDate": "2025-08-06T12:07:54.213285",
           "name": "홍길동"
         }, 
         {
           "commentNo": 2,
           "content": "두번째 댓글 내용입니다.",
           "createdDate": "2025-08-06T12:07:54.213285",
           "name": "김유신"
         }, 
         {
           "commentNo": 4,
           "content": "세번째 댓글 내용입니다.",
           "createdDate": "2025-08-06T12:07:54.213285",
           "name": "홍길동"
         } 
       ]
     }
     ```
   - 구현코드
     ```javascript
     // 댓글목록 정보를 조회하는 함수
     export const fetchComments = async (postNo) => {
       const response = await axios.get(`${API_BASE}/${postNo}/comments`);
       return response.data;
     }
     ```

4. 신규 댓글 추가하기
   - 요청방식: `POST`
   - 요청URI: `/api/posts/게시글번호/comments`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터:
     ```json
     {
       "content": "신규 댓글 내용입니다."
     }
     ```
   - 응답데이터:
     ```json
     {
       "statusCode": 201,
       "message": "댓글이 등록되었습니다.",
       "data": null
     }
     ```
   - 구현코드
     ```javascript
     // 신규 댓글을 추가하는 함수
     export const addComment = async (postNo, content) => {
       const response = await axios.post(`${API_BASE}/${postNo}/comments`, { content });
       return response.data;
     }
     ```

5. 댓글 삭제하기
   - 요청방식: `DELETE`
   - 요청URI: `/api/posts/게시글번호/comments/댓글번호`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터: 없음
   - 응답데이터:
     ```json
     {
       "statusCode": 200,
       "message": "댓글 삭제되었습니다.",
       "data": null
     }
     ```
   - 구현코드
     ```javascript
     // 댓글을 삭제하는 함수
     export const deleteComment = async (postNo, commentNo) => {
       const response = await axios.delete(`${API_BASE}/${postNo}/comments/${commentNo}`);
       return response.data;
     }
     ```

### 게시글 상세  컴포넌트
1. `PostDetail` 컴포넌트 작성하기
    ```jsx
    const PostDetail = ({ post, onDelete }) => {
      // 코드 생략
    }
    export default PostDetail;
    ```

2. 삭제버튼 클릭시 실행되는 이벤트핸들러함수 작성하기
    ```javascript
    const handleDeletePost = () => {
      if (window.confirm("게시글을 삭제하시겠습니까?")) {
        // Props로 전달받은 함수를 실행한다.
        onDelete(post.postNo);
      }
    }
    ```

3. 게시글 상세정보 렌더링하기
    ```jsx
    return (
      <>
        {/* 게시글 상세정보 표현하기 */}
        <div className="mb-3">
          <h1>{post.title}</h1>
          <div>
            <span className="me-3"><i className="bi bi-person-fill"></i> 작성자: <strong className="text-dark">{post.name}</strong></span>
            <span className="me-3"><i className="bi bi-calendar-check-fill"></i> 작성일: {new Date(post.createdDate).toLocaleString()}</span>
            <span className="me-3"><i className="bi bi-eye-fill"></i> 조회수: {post.viewCnt}</span>
            <span className="me-3"><i className="bi bi-list"></i> 댓글수: {post.commentCnt}</span>
          </div>
        </div>
        <hr />
        <div className="card-text mb-3">
          <p>{post.content}</p>
        </div>
        {/* 링크 및 버튼 표시 */}
        <div className="text-end mb-3">
          <Link to={`/posts/update/${post.postNo}`} className="btn btn-warning me-2">
            <i className="bi bi-pencil-square"></i> 수정
          </Link>
          {/* 삭제버튼 클릭시 handleDeletePost 이벤트핸들러 함수를 호출한다. */}
          <button onClick={handleDeletePost} className="btn btn-danger me-2">
            <i className="bi bi-trash-fill"></i> 삭제
          </button>
          <Link to={`/posts/list`} className="btn btn-secondary me-3">
            <i className="bi bi-list"></i> 목록으로
          </Link>
        </div>
      </>
    );
    ```
### 댓글 목록 컴포넌트
1. `CommentList` 컴포넌트 작성하기
    ```jsx
    // Props로 comments, onDelete를 전달받는다.
    //    comments는 댓글 목록정보다.
    //    onDelete는 댓글삭제함수다.
    const CommentList = ({ comments, onDelete }) => {
      // 코드 생략
    };
    export default CommentList;
    ```
2. 댓글 목록정보를 렌더링한다.
    ```jsx
    return (
      <div>
        <h4> 댓글 (<span>{comments.length}</span>)</h4>
        {comments.length === 0 ? (
          <div className="alert alert-info small mb-3">
            등록된 댓글이 없습니다.
          </div>
        ) : (
          <div className="small mb-3">
            {comments.map(comment => (
                <div className="mb-3 border p-3" key={comment.commentNo}>
                    <div className="mb-1">
                        <strong><i className="bi bi-person-cicle"></i> <span>{comment.name}</span></strong>
                        <span> | <i className="bi bi-calendar-check"></i> {new Date(comment.createdDate).toLocaleString()}</span>
                    </div>
                    <div className="card-text">
                        <p>{comment.content}</p>
                    </div>
                    <div className="text-end">
                        <!-- 삭제버튼을 클릭하면 Props로 전달받은 onDelete함수를 실행한다. -->
                        <button type="button" className="btn btn-sm btn-outline-danger"
                            onClick={() => onDelete(comment.commentNo)}>삭제</button>
                    </div>
                </div>
            ))}
          </div>                
        )}
      </div>
    );
    ```
### 댓글 등록폼 컴포넌트
1. `CommentForm` 컴포넌트 작성하기
    ```jsx
    // Props로 신규 댓글을 등록시키는 함수를 전달받는다.
    const CommentForm = ({ onAdd }) => {
      // 코드 생략
    }
    export default CommentForm;
    ```
2. 신규 댓글 내용을 State로 관리한다.
    ```jsx
    const [content, setContent] = useState('');
    ```
3. 댓글작성 폼에서 submit 이벤트 발생시 실행할 이벤트핸들러 함수를 작성한다.
    ```jsx
    const handleSubmit = (e) => {
      e.preventDefault();

      onAdd(content);  // Props로 전달받은 onAdd를 호출한다.
      setContent('');  // 입력폼에 표시되는 content값을 ''으로 업데이트한다.
    }
    ```
4. 댓글 입력폼을 렌더링한다.
    ```jsx
    return (
      <div className="mb-3">
        <h5>댓글 작성</h5>
        <!-- <form>태그에서 onSubmit 이벤트에 이벤트핸들러 함수를 바인딩한다. -->
        <form onSubmit={handleSubmit}>
            <div className="mb-3">
                <!-- <textarea>태그에서 onChange 이벤트에 이벤트핸들러함수를 작성해서 바인딩한다. -->
                <textarea className="form-control" rows="3"
                    value={content}
                    onChange={(e) => setContent(e.target.value)}
                    placeholder="댓글을 입력하세요"></textarea>
            </div>
            <div className="text-end">
              <button type="submit" className="btn btn-sm btn-primary">댓글 작성</button>
            </div>
        </form>
      </div>
    );
    ```
### 댓글상세페이지 컴포넌트
1. `DetailPage` 컴포넌트 작성하기
    ```jsx
    const DetailPage = () => {
      // 코드 생략
    };
    export default DetailPage;
    ```
2. `DetailPage` 컴포넌트 요청시 전달받은 no값 획득하기
    ```jsx
    // userParams()은 현재 URL 경로에서 동적 파라미터 값을 추출한다.
    //     DetailPage 컴포넌트는 '/posts/detail/:no' URL에 매핑된다.
    //     DetailPage 컴포넌트는 '/posts/detail/5'와 같은 URL로 접근한다.
    //     아래의 코드는 URL 경로에서 ":no"에 해당하는 5로 추출해서 변수 no에 대입한다.
    const { no } = useParams();
    ```
3. `State`로 게시글정보, 댓글목록정보를 관리한다.
    ```jsx
    const [post, setPost] = useState(null);
    const [comments, setcomments] = useState([]);
    ```
4. 백엔드 API에서 게시글 정보를 조회하고 State를 갱신하는 함수를 작성한다.
    ```jsx
    const getPost = async (postNo) => {
      try {
        const response = await fetchPostDetail(postNo);
        setPost(response.data);
      } catch (error) {
        console.error('게시글 상세 조회 실패', error.response.data.message);
      }
    }
    ```
5. 백엔드 API에서 댓글목록 정보를 조회하고 State를 갱신하는 함수를 작성한다.
    ```jsx
    const getComments = async (postNo) => {
      try {
        const response = await fetchComments(postNo);
        setComments(response.data);
      } catch (error) {
        console.error('게시글 상세 조회 실패', error.response.data.message);
      }
    }
    ```
6. 'useEffect' 훅을 사용해서 게시글번호가 변경될 때마다 게시글정보와 댓글정보를 갱신하는 이펙트함수를 작성한다.
    ```jsx
    useEffect(() => {
      getPost(no);
      getComments(no);
    }, [no]);
    ```
7. 게시글을 작성하는 이벤트핸들러 함수를 작성한다.
    ```jsx
    const handleDelete = async (postNo) => {
      try {
        await deletePost(postNo);
        navigate('/posts/list');
      } catch (error) {
        alert('게시글 삭제 실패 : ' + error.response.data.message);
      }
    }
    ```
8. 신규 댓글정보를 등록하는 이벤트핸들러 함수를 작성한다.
    ```jsx
    const handleAddComment = async (content) => {
      try {
        await addComment(no, content);
        await getComments(no);
      } catch (error) {
        alert('댓글 등록 실패 : ' + error.response.data.message);
      }
    }
    ```
9. 댓글정보를 삭제하는 이벤트핸들러 함수를 작성한다.
    ```jsx
    const handleDeleteComment = async (commentNo) => {
      try {
        await deleteComment(no, commentNo);
        await getComments(no);
      } catch (error) {
        alert('댓글 삭제 실패 : ' + error.response.data.message);
      }
    }
    ```
10. `ContentLayout`, `PostDetail`, `CommentLayout` 컴포넌트를 이용해서 `DetailPage`를 구성한다.
    ```jsx
    return (
      <ContentLayout title="게시글 상세">
        {post === null ? (
          <p className="card-text">로딩 중 ...</p>
        ) : (
          <>
            <PostDetail post={post} onDelete={handleDelete}/>
            <CommentLayout comments={comments}  onAdd={handleAddComment} onDelete={handleDeleteComment}/>
          </>
      </ContentLayout>
    )
    ```
