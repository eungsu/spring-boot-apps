# 게시글 수정

## 구성 파일
#### `pages/posts/UpdateFormPage.jsx`
- `/posts/update/:no` URL에 매핑되는 페이지다.
- 주요 내용
  - URL에서 게시글번호를 획득한다.
  - 수정할 게시글정보를 `State`로 관리한다.
  - 백엔드 API에서 게시글정보를 조회하는 함수를 작성한다.
  - `useEffect`로 게시글번호가 변경될 때 마다 수정할 게시글정보를 갱신하는 이펙트함수를 작성한다.
  - 게시글 수정폼을 표현하는 `PostUpdateForm`컴포넌트를 포함한다.
  - `Props`를 이용해서 `PostUpdateForm`에 수정할 게시글정보를 전달한다. 
#### `components/posts/PostUpdateForm.jsx`
- 게시글 수정폼을 표시하는 컴포넌트다.
- 주요 내용
  - `State`로 게시글 제목, 게시글 내용을 관리한다.
  - 수정폼에서 submit 이벤트 발생시 실행할 이벤트핸들러 함수를 작성한다.
#### `api/posts.js`
- `axios`를 사용하여 백엔드 API와 통신한다.
- 주요 내용
  - 게시글 수정 요청 함수를 제공한다.
 
## 코드 구현하기
### 백엔드 API와 연동
1. 게시글 수정하기
   - 요청방식: `PUT`
   - 요청URL: `/api/posts/게시글번호`
   - 요청파라미터: 없음
   - 요청헤더: `Authorization:Bearer JWT_ACCESS_TOKEN`
   - 요청데이터:
     ```json
     {
       "title":"수정된 제목",
       "content":"수정된 내용입니다."
     }
     ```
   - 응답데이터:
     ```json
     {
       "statusCode":200,
       "message":"게시글이 수정되었습니다.",
       "data":null
     }
     ```
   - 구현코드
     ```javascript
     export const updatePost = async (postNo, postData) => {
       const response = await axios.put(`${API_BASE}/${postNo}`, postData);
       return response.data;
     }
     ```
### 게시글 수정폼 컴포넌트
1. `PostUpdateForm` 컴포넌트 작성하기
    ```javascript
    // Props로 수정할 게시글 정보를 전달받는다.
    const PostUpdateForm = ({ post }) => {
      // 코드생략
    }
    export default PostUpdateForm;
    ```
2. `State`로 수정할 게시글 정보 관리하기
    ```jsx
    const [title, setTitle] = useState(post.title);
    const [content, setContent] = useState(post.content);
    ```
3. `<form>`태그에서 submit 이벤트 발생시 실행할 이벤트핸들러 함수 작성하기
    ```jsx
    const handleUpdate = async (e) => {
      e.preventDefault();
      try {
        await updatePost(post.postNo, { title, content });
        alert("게시글이 수정되었습니다.");
        navigate(`/posts/detail/${post.postNo}`)
      } catch (error) {
        alert('게시글 수정 실패: ' + error.response.data.message);
      }
    }
    ```
4. 수정폼 작성하기
    ```jsx
    return (
      <!-- form에서 submit 이벤트 발생시 handleUpdate이벤트 핸들러함수를 실행한다. -->
      <form onSubmit={handleUpdate}>
        <div className="mb-3">
          <label className="form-label">제목</label>
          <!-- State가 관리하는 title을 표시하고,
               입력값이 변경될 때 마다 setTitle()를 호출해서
               State의 title값을 변경한다.
          -->
          <input type="text"
            className="form-control"
            value={title} 
            onChange={(e) => setTitle(e.target.value)} />
        </div>
        <div className="mb-3">
          <label className="form-label">내용</label>
          <!-- State가 관리하는 content을 표시하고,
               입력값이 변경될 때 마다 setContent()를 호출해서
               State의 content값을 변경한다.
          -->
          <textarea className="form-control"
            rows="7"
            value={content}
            onChange={(e) => setContent(e.target.value)}></textarea>
        </div>
        <div className="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="submit" className="btn btn-primary">
            <i className="bi bi-send-fill me-2"></i> 수정
          </button>
          <Link to="/posts/list" className="btn btn-secondary">
            <i className="bi bi-x-circle-fill me-2"></i> 취소
          </Link>
        </div>
      </form>
    )
    ```
### 게시글 수정 페이지 작성하기
1. `UpdateFormPage` 작성하기
    ```jsx
    const UpdateFormPage = () => {
      // 코드생략
    }
    export default UpdateFormPage;
    ```
2. `useParams`로 URL에서 게시글번호를 획득한다.
    ```jsx
    const { no } = useParams();
    ```
3. `State`로 수정할 게시글정보 관리하기
    ```jsx
     const [post, setPost] = useState(null);
    ```
4. 백엔드 API에서 게시글정보를 조회해서 `State`로 관리하는 게시글정보 설정하기
    ```jsx
    const getPost = async (postNo) => {
      try {
        const response = await fetchPostDetail(postNo);
        setPost(response.data);
      } catch (error) {
        console.error('게시글 조회 실패', error.response.data.message);
      }
    }
    ```
5. `useEffect`로 게시글번호가 변경될 때 마다 게시글정보 다시 조회하는 이펙트함수 작성하기
    ```jsx
    useEffect(() => {
      getPost(no);
    }, [no]);    
    ```
6. `ContentLayout`, `PostUpdateForm`를 포함하기 페이지 렌더링하기
    ```jsx
    return (
      <ContentLayout title="게시글 수정">
        {post === null ? (
          <div className="card-text">로딩 중 ...</div>
        ) : (
          <PostUpdateForm post={post}/>
        )}
      </ContentLayout>
    );
    ```
