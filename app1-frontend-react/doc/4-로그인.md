# 로그인

## 구현내용
- `componets/Signup.jsx` 컴포넌트에 로그인폼, 이벤트핸들러 전부 포함하고 있다.
- `componets/Signup.jsx` 컴포넌트는 로그인폼 화면이 있다.
- `componets/Signup.jsx` 컴포넌트는 useState()로 로그인폼데이터를 관리한다.
- `componets/Signup.jsx` 컴포넌트는 입력값이 변경될 때, 폼을 제출할 때 실행되는 이벤트핸들러를 포함하고 있다.
- `context/AuContext.jsx` 컴포넌트로 인증이 완료된 후 획득한 토큰정보를 관리한다.

## 구성파일
#### `pages/LoginPage.jsx`
- `/login` URL에 매핑되는 페이지다.
- 주요 내용
  - 로그인 폼을 표현하는 `Login.jsx` 컴포넌트를 포함한다.
#### `components/Login.jsx`
- 로그인 폼을 표시하는 컴포넌트다.
- 주요 내용
  - 로그인폼의 폼입력값 관리
  - 이벤트 핸들러 정의
  - 로그인 폼
#### `api/auth.js`
- `axios`를 사용하여 백엔드 API와 통신한다.
- 주요 내용
  - 로그인 요청 함수 제공
#### `context/AuthContext.jsx`
- JWT 토큰과 인증상태 정보를 관리하는 React Context다.
- 주요 내용
  - JWT 토큰정보 관리
  - 토크정보 저장, 업데이트, 삭제
 
## 코드 구현하기
### 백엔드 API와 연동
1. `api/auth.js` 로그인 요청을 서버로 보내고 응답받기
   - 요청방식: `POST`
   - 요청URI: `/api/auth/login`
   - 요청데이터: `{"username":"hong", "password":"hong123"}`
   - 응답데이터: `{"stateCode":200, "message":"로그인 완료", "data":{"accessToken":"xxx", "refreshToken":"xxx", "expiresAt":1753681194215}}`
    ```jsx
    export const login = async (loginData) => {
      const response = await axios.post(`${API_BASE}/login`, loginData);
      return response.data;
    }
    ```
### JWT 토큰 관리
- `React Context`를 이용해서 JWT 토큰관리, 인증여부 정보를 관리하는 `context/AuthContext.jsx`를 작성한다.
- 주요 내용
    ```
    context AuthContext = creatContext();
    export const AuthProvider = ({ children }) => {
      // useState로 JWT 토큰정보 관리
      // localStorage에서 값을 읽어와서 초기화한다.
      const [auth, setAuth] = useState({
        accessToken: localStorage.getItem('accessToken'),
        refreshToken: localStorage.getItem('refreshToken'),
        expiresAt: parseInt(localStorage.getItem('expiresAt')) || 0,
        isAuthenticated: !!localStorage.getItem('accessToken')
      });

      const updateTokens = async () => {
        // jwt 토큰정보를 업데이트하는 코드
      }

      const saveTokens = ({accessToken, refreshToken, expiresAt }) => {
        // 로그인 완료시 응답으로 받은 토큰정보를 저장시키는 코드
      }

      const clearToken = () => {
        // JWT 토큰정보를 삭제하는 코드
      }

      // 나머지 코드 생략
    }
    ```
### 로그인폼 컴포넌트
1. `Login` 컴포넌트 작성하기
    ```jsx
    const Login = () => {
      // 코드 생략
    }
    ```
2. `useState`로 폼입력데이터 초기화하고 상태관리하기
    ```jsx
    const [loginData, setLoginData] = useState({
      username: '',
      password: ''
    }
    ```
3. 입력폼 작성하기
    ```jsx
    return (
      <form>
        ...
        <input type="text" className="form-control" name="username"/>
        ...
        <input type="text" className="form-control" name="password"/>
        ...
        <button type="submit" className="btn btn-primary">로그인</button>
      </form>
    );
    ```
4. 입력필드값 변경시 실행되는 이벤트핸들러 작성하기
    ```jsx
    const handleChage = (e) => {
      const { name, value } = e.target;
      setFormData((prev) => ({ ...prev, [name]:value }));
    ```
5. 입력필드에 이벤트핸들러 바인딩하기
    ```jsx
    return (
      <form>
        ...
        <input type="text" className="form-control" name="username" onClick={handleChange} />
        ...
        <input type="text" className="form-control" name="password" onClick={handleChange} />
        ...
        <button type="submit" className="btn btn-primary">로그인</button>
      </form>
    );
    ```
6. `<form/>`에서 `submit`이벤트 발생시 실행되는 이벤트핸들러 작성하기
    ```jsx
    const handleLogin = async (e) => {
      e.preventDefault();
      try {
        // 백엔드 서버와 통신하는 login()함수를 호출한다.
        const response = await login(loginData);
        // 응답데이터에서 JWT 토큰정보를 획득한다.
        const { accessToken, refreshToken, expiresAt } = response.data;
        // JWT 토큰정보를 저장시킨다.
        saveTokens({ accessToken, refreshToken, expiresAt });

        alert(response.message);
        navigate('/');
      } catch (error) {
        alert("로그인 오류 발생: " + error.response.data.message);
      }
    }
    ```
7. `<form>`태그에 이벤트핸들러 바인딩하기
    ```jsx
    return (
      <form onSubmit={handleSubmit}>
        // 코드생략
      </form> 
    );
    ```
### 로그인 페이지 작성하기
1. `LoginPage` 작성하기
    ```jsx
    const LoginPage = () => {
      return (

      );
    }
    export defatul LoginPage;
    ```
2. `PageContainer`와 `Login` 컴포넌트 포함하기
    ```jsx
    const LoginPage = () => {
      return (
        <PageContainer title="로그인">
          <Login />
        </PageContainer>
      );
    }
    export defatul LoginPage;
    ``` 
